<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>LaTeXæ¸²æŸ“ä¿®å¤æµ‹è¯•</title>
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/katex@0.16.8/dist/katex.min.css">
    <script src="https://cdn.jsdelivr.net/npm/katex@0.16.8/dist/katex.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/katex@0.16.8/dist/contrib/auto-render.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/marked/marked.min.js"></script>
    <style>
        body {
            font-family: Arial, sans-serif;
            max-width: 800px;
            margin: 0 auto;
            padding: 20px;
            line-height: 1.6;
        }
        .test-section {
            margin: 20px 0;
            padding: 15px;
            border: 1px solid #ddd;
            border-radius: 8px;
        }
        .test-title {
            font-weight: bold;
            color: #333;
            margin-bottom: 10px;
        }
        .test-result {
            background-color: #f9f9f9;
            padding: 10px;
            border-radius: 4px;
            margin-top: 10px;
        }
        button {
            background-color: #007bff;
            color: white;
            border: none;
            padding: 10px 20px;
            border-radius: 4px;
            cursor: pointer;
            margin: 5px;
        }
        button:hover {
            background-color: #0056b3;
        }
    </style>
</head>
<body>
    <h1>ğŸ§ª LaTeXæ¸²æŸ“ä¿®å¤æµ‹è¯•é¡µé¢</h1>
    
    <button onclick="runFullTest()">ğŸš€ è¿è¡Œå®Œæ•´æµ‹è¯•</button>
    <button onclick="clearResults()">ğŸ§¹ æ¸…ç©ºç»“æœ</button>
    
    <div id="results"></div>

    <script>
        // ä¿®å¤åçš„æ¸²æŸ“å‡½æ•°
        function renderMarkdown(content) {
            if (!content || typeof content !== 'string') {
                return content || '';
            }
            
            console.log('ğŸ¯ å¼€å§‹æ¸²æŸ“ï¼ŒåŸå§‹å†…å®¹:', content);
            
            // ç¬¬ä¸€æ­¥ï¼šä¿æŠ¤æ•°å­¦å…¬å¼ä¸ºä»£ç å—
            let processed = content;
            
            // ä¿æŠ¤æ˜¾ç¤ºå…¬å¼ $$...$$ 
            processed = processed.replace(/\$\$([\s\S]*?)\$\$/g, '`$$$1$$`');
            
            // ä¿æŠ¤ \[...\] æ˜¾ç¤ºå…¬å¼
            processed = processed.replace(/\\\[([\s\S]*?)\\\]/g, '`\\[$1\\]`');
            
            // ä¿æŠ¤å†…è”å…¬å¼ $...$
            processed = processed.replace(/\$([^$\n]+?)\$/g, '`$$1$`');
            
            // ä¿æŠ¤ \(...\) å†…è”å…¬å¼
            processed = processed.replace(/\\\(([^)]*?)\\\)/g, '`\\($1\\)`');
            
            console.log('ğŸ›¡ï¸ ä¿æŠ¤æ•°å­¦å…¬å¼å:', processed);
            
            // ç¬¬äºŒæ­¥ï¼šå¤„ç†ä»£ç å—
            processed = processed.replace(/```(\w+)?\n([\s\S]*?)```/g, (match, lang, code) => {
                const language = lang || 'text';
                return `<pre><code class="language-${language}">${escapeHtml(code.trim())}</code></pre>`;
            });
            
            // ç¬¬ä¸‰æ­¥ï¼šä½¿ç”¨markedå¤„ç†Markdown
            let html = marked.parse(processed);
            console.log('ğŸ“ Markdownå¤„ç†å:', html);
            
            // ç¬¬å››æ­¥ï¼šæ¢å¤æ•°å­¦å…¬å¼å¹¶ç§»é™¤ä»£ç æ ‡ç­¾
            // æ¢å¤æ˜¾ç¤ºå…¬å¼ $$...$$ 
            html = html.replace(/<code>\$\$([\s\S]*?)\$\$<\/code>/g, '$$$$1$$');
            
            // æ¢å¤ \[...\] æ˜¾ç¤ºå…¬å¼
            html = html.replace(/<code>\\\[([\s\S]*?)\\\]<\/code>/g, '\\[$1\\]');
            
            // æ¢å¤å†…è”å…¬å¼ $...$
            html = html.replace(/<code>\$([^$]*?)\$<\/code>/g, '$$$1$$');
            
            // æ¢å¤ \(...\) å†…è”å…¬å¼  
            html = html.replace(/<code>\\\(([^)]*?)\\\)<\/code>/g, '\\($1\\)');
            
            console.log('âœ… æ•°å­¦å…¬å¼æ¢å¤å:', html);
            
            return html;
        }

        function escapeHtml(text) {
            const div = document.createElement('div');
            div.textContent = text;
            return div.innerHTML;
        }

        function runTest(title, input, description) {
            const resultsDiv = document.getElementById('results');
            
            const testDiv = document.createElement('div');
            testDiv.className = 'test-section';
            
            testDiv.innerHTML = `
                <div class="test-title">${title}</div>
                <div><strong>è¾“å…¥:</strong> ${escapeHtml(input)}</div>
                <div><strong>è¯´æ˜:</strong> ${description}</div>
                <div class="test-result" id="result_${Date.now()}">æ¸²æŸ“ä¸­...</div>
            `;
            
            resultsDiv.appendChild(testDiv);
            
            const resultDiv = testDiv.querySelector('.test-result');
            
            try {
                const rendered = renderMarkdown(input);
                resultDiv.innerHTML = rendered;
                
                // åº”ç”¨KaTeXæ¸²æŸ“
                setTimeout(() => {
                    renderMathInElement(resultDiv, {
                        delimiters: [
                            {left: "$$", right: "$$", display: true},
                            {left: "\\[", right: "\\]", display: true},
                            {left: "$", right: "$", display: false},
                            {left: "\\(", right: "\\)", display: false}
                        ],
                        throwOnError: false,
                        strict: false
                    });
                }, 10);
                
            } catch (error) {
                resultDiv.innerHTML = `<span style="color: red;">é”™è¯¯: ${error.message}</span>`;
            }
        }

        function runFullTest() {
            clearResults();
            
            // æµ‹è¯•ç”¨ä¾‹
            const tests = [
                {
                    title: "1. åŸºæœ¬å†…è”å…¬å¼",
                    input: "è¿™æ˜¯ä¸€ä¸ªå†…è”å…¬å¼ $x^2 + y^2 = z^2$ åœ¨å¥å­ä¸­ã€‚",
                    description: "åº”è¯¥æ˜¾ç¤ºå‹¾è‚¡å®šç†å…¬å¼"
                },
                {
                    title: "2. æ˜¾ç¤ºå…¬å¼",
                    input: "è¿™æ˜¯ä¸€ä¸ªæ˜¾ç¤ºå…¬å¼ï¼š\n\n$$\\int_{-\\infty}^{\\infty} e^{-x^2} dx = \\sqrt{\\pi}$$\n\né«˜æ–¯ç§¯åˆ†ã€‚",
                    description: "åº”è¯¥æ˜¾ç¤ºå±…ä¸­çš„é«˜æ–¯ç§¯åˆ†å…¬å¼"
                },
                {
                    title: "3. å¸Œè…Šå­—æ¯ç»„åˆ",
                    input: "å¸Œè…Šå­—æ¯æµ‹è¯•ï¼š$\\alpha + \\beta = \\gamma$, $\\pi \\approx 3.14159$",
                    description: "åº”è¯¥æ˜¾ç¤ºå¸Œè…Šå­—æ¯"
                },
                {
                    title: "4. åˆ†æ•°ä¸æ ¹å·",
                    input: "åˆ†æ•°ï¼š$\\frac{a}{b} + \\frac{c}{d}$ å’Œæ ¹å·ï¼š$\\sqrt{x^2 + y^2}$",
                    description: "åº”è¯¥æ˜¾ç¤ºåˆ†æ•°å’Œæ ¹å·"
                },
                {
                    title: "5. æ±‚å’Œä¸ç§¯åˆ†",
                    input: "æ±‚å’Œï¼š$\\sum_{i=1}^{n} x_i$ å’Œç§¯åˆ†ï¼š$\\int_a^b f(x)dx$",
                    description: "åº”è¯¥æ˜¾ç¤ºæ±‚å’Œå’Œç§¯åˆ†ç¬¦å·"
                },
                {
                    title: "6. çŸ©é˜µ",
                    input: "çŸ©é˜µï¼š$$\\begin{pmatrix} a & b \\\\ c & d \\end{pmatrix}$$",
                    description: "åº”è¯¥æ˜¾ç¤º2x2çŸ©é˜µ"
                },
                {
                    title: "7. æ··åˆæ–‡æœ¬å’Œå…¬å¼",
                    input: "**ç²—ä½“æ–‡æœ¬** å’Œå…¬å¼ $E = mc^2$ï¼Œè¿˜æœ‰*æ–œä½“* $F = ma$ã€‚",
                    description: "åº”è¯¥æ­£ç¡®æ˜¾ç¤ºMarkdownæ ¼å¼å’ŒLaTeXå…¬å¼çš„æ··åˆ"
                },
                {
                    title: "8. ä½ æåˆ°çš„é—®é¢˜æ¡ˆä¾‹",
                    input: "ä¸Šä¸‹æ ‡ï¼š$x^2$ â†’ MATH_INLINE_29\nä¸‹æ ‡ï¼š$a_n$ â†’ MATH_INLINE_30\nç»„åˆï¼š$C_n^k$ â†’ MATH_INLINE_31",
                    description: "è¿™äº›ä¸åº”è¯¥æ˜¾ç¤ºMATH_INLINE_XXï¼Œè€Œåº”è¯¥æ˜¾ç¤ºæ­£ç¡®çš„æ•°å­¦å…¬å¼"
                }
            ];
            
            tests.forEach(test => {
                runTest(test.title, test.input, test.description);
            });
        }

        function clearResults() {
            document.getElementById('results').innerHTML = '';
        }

        // é¡µé¢åŠ è½½å®Œæˆåè‡ªåŠ¨è¿è¡Œæµ‹è¯•
        window.addEventListener('load', () => {
            console.log('ğŸ“š LaTeXä¿®å¤æµ‹è¯•é¡µé¢å·²åŠ è½½');
            setTimeout(runFullTest, 500);
        });
    </script>
</body>
</html> 